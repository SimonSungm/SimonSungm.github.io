<html lang="en"><head>
    <meta charset="UTF-8">
    <title></title>
<style id="system" type="text/css">h1,h2,h3,h4,h5,h6,p,blockquote {    margin: 0;    padding: 0;}body {    font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", Arial, sans-serif;    font-size: 13px;    line-height: 18px;    color: #737373;    margin: 10px 13px 10px 13px;}a {    color: #0069d6;}a:hover {    color: #0050a3;    text-decoration: none;}a img {    border: none;}p {    margin-bottom: 9px;}h1,h2,h3,h4,h5,h6 {    color: #404040;    line-height: 36px;}h1 {    margin-bottom: 18px;    font-size: 30px;}h2 {    font-size: 24px;}h3 {    font-size: 18px;}h4 {    font-size: 16px;}h5 {    font-size: 14px;}h6 {    font-size: 13px;}hr {    margin: 0 0 19px;    border: 0;    border-bottom: 1px solid #ccc;}blockquote {    padding: 13px 13px 21px 15px;    margin-bottom: 18px;    font-family:georgia,serif;    font-style: italic;}blockquote:before {    content:"¬ÅC";    font-size:40px;    margin-left:-10px;    font-family:georgia,serif;    color:#eee;}blockquote p {    font-size: 14px;    font-weight: 300;    line-height: 18px;    margin-bottom: 0;    font-style: italic;}code, pre {    font-family: Monaco, Andale Mono, Courier New, monospace;}code {    background-color: #fee9cc;    color: rgba(0, 0, 0, 0.75);    padding: 1px 3px;    font-size: 12px;    -webkit-border-radius: 3px;    -moz-border-radius: 3px;    border-radius: 3px;}pre {    display: block;    padding: 14px;    margin: 0 0 18px;    line-height: 16px;    font-size: 11px;    border: 1px solid #d9d9d9;    white-space: pre-wrap;    word-wrap: break-word;}pre code {    background-color: #fff;    color:#737373;    font-size: 11px;    padding: 0;}@media screen and (min-width: 768px) {    body {        width: 748px;        margin:10px auto;    }}</style><style id="custom" type="text/css"></style></head>
<body marginheight="0"><h1>Enviroment</h1>
<h3>1.Host Enviroment</h3>
<pre><code>host : Ubuntu 18.04
GCC version : 9.1.0
Binutils version : 2.3
Glibc version : 2.27
Bison version : 3.0.4
Flex version : 2.6.4
GMP version : 6.1.2
MPC version : 1.1.0
MPFR version : 4.0.1
Texinfo version : 6.5.0
CLooG version : 0.18.4
ISL version : 0.19</code></pre>
<h3>2.Target</h3>
<pre><code>Source dir : /media/cliff/Work2/testKernel/src/
Target dir : $HOME/opt/cross
Gcc version : 9.1
Binutils version : 2.32
Linux kernel version : 5.0.1
Glibc version : 2.30</code></pre>
<h1>Step</h1>
<h3>1.download source</h3>
<p>Binutils : <a href="https://www.gnu.org/software/binutils/">Binutils website</a>, <a href="https://ftp.gnu.org/gnu/binutils/">the GNU main mirror</a>.

</p>
<p>GCC : <a href="https://www.gnu.org/software/gcc/">GCC website</a>, <a href="https://ftp.gnu.org/gnu/gcc/">the GNU main mirror</a>.

</p>
<p>Linux : <a href="https://mirrors.edge.kernel.org/pub/linux/kernel/">Index of /pub/linux/kernel/</a>

</p>
<p>Glibc : <a href="http://mirrors.kernel.org/gnu/glibc/">Index of /gnu/glibc/</a>

</p>
<pre><code class="lang-shell">$ cd /media/cliff/Work2/testKernel/src/
$ ls 
    binutils-2.32   gcc-9.1   glibc-2.30    linux-5.0.1</code></pre>
<p>Patching gcc before compiling glibc
If you find that compiling glibc is problematic, or crashes every time, and it concerns 'libsantizer asan' you will need to patch gcc-9.1.0 before it will compile successfully.

</p>
<p>First, move into your 'BUILD' directory and create the patch file.
</p>
<pre><code>touch asan_linux-cc.patch</code></pre>
<p>Next, copy the code below into the asan_linux-cc.patch file or use cat as shown below. It needs to be exact!

</p>
<pre><code class="lang-c">--- orig/asan_linux.cc    2019-07-11 21:18:56.000000000 +0100
+++ mod/asan_linux.cc    2019-07-11 16:31:42.000000000 +0100
@@ -75,6 +75,10 @@
 asan_rt_version_t  __asan_rt_version;
 }

+#ifndef PATH_MAX
+#define PATH_MAX 4096
+#endif
+
 namespace __asan {

 void InitializePlatformInterceptors() {}</code></pre>
<p>Check the contents of the file and verify that they look the same as shown here, including an empty line at the bottom. Then you are able to finally patch the offending file using the following command:

</p>
<p>patch -b gcc-9.1/libsanitizer/asan/asan_linux.cc asan_linux-cc.patch
This will patch the file and create a backup [option -b] in case things don't go as planned. Now you should find that glibc compiles without any problem(s).

</p>
<p>NB: The location of the backed up file is: gcc-9.1/libsanitizer/asan/asan_linux.cc.orig


</p>
<h3>2.set enviroment value</h3>
<pre><code class="lang-shell">export PREFIX="$HOME/opt/cross"
export TARGET=aarch64-linux
export PATH="$PREFIX/bin:$PATH"</code></pre>
<h3>3.build Binutils</h3>
<pre><code class="lang-shell">cd /media/cliff/Work2/testKernel/src/
mkdir build-binutils
cd build-binutils
../binutils-2.32/configure --target=$TARGET --prefix=$PREFIX --with-sysroot --disable-multilib
make -j12
make install
cd ..</code></pre>
<h3>4.Linux Kernel headers</h3>
<pre><code class="lang-shell">cd linux-5.0.1
make ARCH=arm64 INSTALL_HDR_PATH=$PREFIX/$TARGET headers_install
cd ..</code></pre>
<h3>5.build GCC</h3>
<pre><code class="lang-shell">mkdir -p build-gcc
cd build-gcc
../gcc-9.1/configure --prefix=$PREFIX --target=$TARGET --enable-languages=c,c++ --disable-multilib
make -j12 all-gcc
make install-gcc
cd ..</code></pre>
<h3>6.build Glibc</h3>
<pre><code class="lang-shell">mkdir -p build-glibc
cd build-glibc
../glibc-2.30/configure --prefix=$PREFIX/$TARGET --build=$MACHTYPE --host=aarch64-linux --target=aarch64-linux --with-headers=$PREFIX/$TARGET/include --disable-multilib libc_cv_forced_unwind=yes
make install-bootstrap-headers=yes install-headers
make -j12 csu/subdir_lib
install csu/crt1.o csu/crti.o csu/crtn.o $PREFIX/$TARGET/lib
aarch64-linux-gcc -nostdlib -nostartfiles -shared -x c /dev/null -o $PREFIX/$TARGET/lib/libc.so
touch $PREFIX/$TARGET/include/gnu/stubs.h
cd ..</code></pre>
<h3>7.Compiler Support Library</h3>
<pre><code class="lang-shell">cd build-gcc
make -j12 all-target-libgcc
make install-target-libgcc
cd ..</code></pre>
<h3>8.Standard C Library</h3>
<pre><code class="lang-shell">cd build-glibc
make -j12
make install
cd ..</code></pre>
<h3>9.Standard C++ Library</h3>
<pre><code class="lang-shell">cd build-gcc
make -j12
make install
cd ..</code></pre>
<h1>Reference</h1>
<p>[1]<a href="https://wiki.osdev.org/GCC_Cross-Compiler"></a><a href="https://wiki.osdev.org/GCC_Cross-Compiler">https://wiki.osdev.org/GCC_Cross-Compiler</a>

</p>
<p>[2]<a href="https://preshing.com/20141119/how-to-build-a-gcc-cross-compiler/"></a><a href="https://preshing.com/20141119/how-to-build-a-gcc-cross-compiler/">https://preshing.com/20141119/how-to-build-a-gcc-cross-compiler/</a>

</p>
<p>[3]<a href="http://docs.slackware.com/howtos:hardware:arm:gcc-9.x_aarch64_cross-compiler"></a><a href="http://docs.slackware.com/howtos:hardware:arm:gcc-9.x_aarch64_cross-compiler">http://docs.slackware.com/howtos:hardware:arm:gcc-9.x_aarch64_cross-compiler</a>

</p>
<p>Edit By <a href="http://mahua.jser.me">MaHua</a></p>
</body></html>