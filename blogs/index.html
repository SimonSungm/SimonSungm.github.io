<h1>Enviroment</h1>

<h3>1.Host Enviroment</h3>

<pre><code>host : Ubuntu 18.04
GCC version : 9.1.0
Binutils version : 2.3
Glibc version : 2.27
Bison version : 3.0.4
Flex version : 2.6.4
GMP version : 6.1.2
MPC version : 1.1.0
MPFR version : 4.0.1
Texinfo version : 6.5.0
CLooG version : 0.18.4
ISL version : 0.19</code></pre>

<h3>2.Target</h3>

<pre><code>Source dir : /media/cliff/Work2/testKernel/src/
Target dir : $HOME/opt/cross
Gcc version : 9.1
Binutils version : 2.32
Linux kernel version : 5.0.1
Glibc version : 2.30</code></pre>

<h1>Step</h1>

<h3>1.download source</h3>

<p>Binutils : <a href="https://www.gnu.org/software/binutils/">Binutils website</a>, <a href="https://ftp.gnu.org/gnu/binutils/">the GNU main mirror</a>.
GCC : <a href="https://www.gnu.org/software/gcc/">GCC website</a>, <a href="https://ftp.gnu.org/gnu/gcc/">the GNU main mirror</a>.
Linux : <a href="https://mirrors.edge.kernel.org/pub/linux/kernel/">Index of /pub/linux/kernel/</a>
Glibc : <a href="http://mirrors.kernel.org/gnu/glibc/">Index of /gnu/glibc/</a></p>

<p><code>shell
$ cd /media/cliff/Work2/testKernel/src/
$ ls 
    binutils-2.32   gcc-9.1   glibc-2.30    linux-5.0.1
</code></p>

<p>Patching gcc before compiling glibc
If you find that compiling glibc is problematic, or crashes every time, and it concerns &#39;libsantizer asan&#39; you will need to patch gcc-9.1.0 before it will compile successfully.</p>

<p>First, move into your &#39;BUILD&#39; directory and create the patch file.
<code>
touch asan_linux-cc.patch
</code>
Next, copy the code below into the asan_linux-cc.patch file or use cat as shown below. It needs to be exact!</p>

<p><code></code>`c
--- orig/asan<em>linux.cc    2019-07-11 21:18:56.000000000 +0100
+++ mod/asan</em>linux.cc	2019-07-11 16:31:42.000000000 +0100
@@ -75,6 +75,10 @@
 asan<em>rt</em>version<em>t  __asan</em>rt_version;
 }</p>

<p>+#ifndef PATH<em>MAX
+#define PATH</em>MAX 4096
+#endif
+
 namespace __asan {</p>

<p> void InitializePlatformInterceptors() {}
<code></code>`
Check the contents of the file and verify that they look the same as shown here, including an empty line at the bottom. Then you are able to finally patch the offending file using the following command:</p>

<p>patch -b gcc-9.1/libsanitizer/asan/asan<em>linux.cc asan</em>linux-cc.patch
This will patch the file and create a backup [option -b] in case things don&#39;t go as planned. Now you should find that glibc compiles without any problem(s).</p>

<p>NB: The location of the backed up file is: gcc-9.1/libsanitizer/asan/asan_linux.cc.orig</p>

<h3>2.set enviroment value</h3>

<p><code>shell
export PREFIX=&quot;$HOME/opt/cross&quot;
export TARGET=aarch64-linux
export PATH=&quot;$PREFIX/bin:$PATH&quot;
</code></p>

<h3>3.build Binutils</h3>

<p><code>shell
cd /media/cliff/Work2/testKernel/src/
mkdir build-binutils
cd build-binutils
../binutils-2.32/configure --target=$TARGET --prefix=$PREFIX --with-sysroot --disable-multilib
make -j12
make install
cd ..
</code></p>

<h3>4.Linux Kernel headers</h3>

<p><code>shell
cd linux-5.0.1
make ARCH=arm64 INSTALL_HDR_PATH=$PREFIX/$TARGET headers_install
cd ..
</code></p>

<h3>5.build GCC</h3>

<p><code>shell
mkdir -p build-gcc
cd build-gcc
../gcc-9.1/configure --prefix=$PREFIX --target=$TARGET --enable-languages=c,c++ --disable-multilib
make -j12 all-gcc
make install-gcc
cd ..
</code></p>

<h3>6.build Glibc</h3>

<p><code>shell
mkdir -p build-glibc
cd build-glibc
../glibc-2.30/configure --prefix=$PREFIX/$TARGET --build=$MACHTYPE --host=aarch64-linux --target=aarch64-linux --with-headers=$PREFIX/$TARGET/include --disable-multilib libc_cv_forced_unwind=yes
make install-bootstrap-headers=yes install-headers
make -j12 csu/subdir_lib
install csu/crt1.o csu/crti.o csu/crtn.o $PREFIX/$TARGET/lib
aarch64-linux-gcc -nostdlib -nostartfiles -shared -x c /dev/null -o $PREFIX/$TARGET/lib/libc.so
touch $PREFIX/$TARGET/include/gnu/stubs.h
cd ..
</code></p>

<h3>7.Compiler Support Library</h3>

<p><code>shell
cd build-gcc
make -j12 all-target-libgcc
make install-target-libgcc
cd ..
</code></p>

<h3>8.Standard C Library</h3>

<p><code>shell
cd build-glibc
make -j12
make install
cd ..
</code></p>

<h3>9.Standard C++ Library</h3>

<p><code>shell
cd build-gcc
make -j12
make install
cd ..
</code></p>

<h1>Reference</h1>

<p>[1][https://wiki.osdev.org/GCC_Cross-Compiler](https://wiki.osdev.org/GCC_Cross-Compiler)</p>

<p>[2][https://preshing.com/20141119/how-to-build-a-gcc-cross-compiler/](https://preshing.com/20141119/how-to-build-a-gcc-cross-compiler/)</p>

<p>[3][http://docs.slackware.com/howtos:hardware:arm:gcc-9.x_aarch64_cross-compiler](http://docs.slackware.com/howtos:hardware:arm:gcc-9.x<em>aarch64</em>cross-compiler)</p>